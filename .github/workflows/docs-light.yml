name: docs-light

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
    paths:
      - "README.md"
      - "CITATION.cff"
      - ".zenodo.json"
  workflow_dispatch: {}

permissions:
  contents: read

jobs:
  title-canon:
    name: title-canon
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check canonical titles (README/CITATION/.zenodo)
        shell: bash
        run: |
          set -Eeuo pipefail
          TITLE="MCGT : Modèle de la Courbure Gravitationnelle du Temps"
          ERR=0

          if [ ! -f README.md ] || ! grep -qF "$TITLE" README.md; then
            echo "::error title=README non canonique::README.md ne contient pas le titre canonique"
            ERR=1
          fi

          if [ ! -f CITATION.cff ] || ! awk '/^title:/ {print; found=1} END{exit found?0:1}' CITATION.cff | grep -qF "$TITLE"; then
            echo "::error title=CITATION non canonique::CITATION.cff:title n est pas canonique"
            ERR=1
          fi

          if [ -f .zenodo.json ]; then
            python3 - <<'P2'
import json,io,sys
T="MCGT : Modèle de la Courbure Gravitationnelle du Temps"
try:
  obj=json.load(io.open(".zenodo.json","r",encoding="utf-8"))
  sys.exit(0 if obj.get("title")==T else 2)
except Exception:
  sys.exit(2)
P2
            rc=$?
            if [ $rc -ne 0 ]; then
              echo "::error title=Zenodo non canonique::.zenodo.json:title n est pas canonique"
              ERR=1
            fi
          fi

          exit $ERR
