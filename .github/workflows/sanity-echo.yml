name: "sanity-echo"
on:
  workflow_dispatch: {}
permissions:
  contents: read
jobs:
  echo:
    runs-on: ubuntu-latest
    steps:
      - name: "Contexte"
        shell: bash
        run: |
          set -x
          pwd; ls -la
          echo "event=$GITHUB_EVENT_NAME"
          echo "ref=$GITHUB_REF"
      - name: "Prépare artifact"
        shell: bash
        run: |
          mkdir -p .ci-out
          date -u +"%FT%TZ" > .ci-out/echo.ts
          printf '{"ok":true,"ts":"%s"}\n' "$(cat .ci-out/echo.ts)" > .ci-out/echo.json
          ls -la .ci-out || true
      - name: "Ensure artifact présent (pré-upload)"
        shell: bash
        run: |
          if [ ! -e .ci-out/echo.json ]; then
            echo '{"ok":true,"ts":"'"$(date -u +%FT%TZ)"'"}' > .ci-out/echo.json
          fi
          ls -la .ci-out || true
      - name: "Upload artifact"
        uses: actions/upload-artifact@v4
        with:
          name: sanity-echo
          path: .ci-out/
          if-no-files-found: warn
