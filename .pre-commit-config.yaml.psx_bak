exclude: |
  ^\.ci-out/

repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: check-yaml
      - id: end-of-file-fixer
      - id: trailing-whitespace
      - id: check-executables-have-shebangs
      - id: check-shebang-scripts-are-executable
      - id: check-added-large-files
        args: ['--maxkb=51200']   # 50 MB

  - repo: local
    hooks:
      - id: forbid-tex-in-chapters
        name: forbid .tex in chapters (01..10)
        language: system
        stages: [pre-commit]
        pass_filenames: false
        entry: >-
          bash -c "if git diff --cached --name-only | grep -E '^(0[1-9]|10)-.*/.*\.tex$' >/dev/null; then echo 'ERROR: .tex interdits dans 01..10'; exit 1; fi"

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.4.4
    hooks:
      - id: ruff
        args: [--fix]
      - id: ruff-format

  - repo: https://github.com/psf/black
    rev: 24.4.2
    hooks:
      - id: black

# --- Local guards (Option B) ---

  - repo: local
    hooks:
      - id: forbid-cp-n-in-tools
        name: forbid cp -n in tools
        language: system
        entry: bash -lc '(! grep -R --line-number -E "^[[:space:]]*cp[[:space:]]+-n\\b" tools)'
        files: ^tools/.*\.sh$
      - id: forbid-duplicate-psx-override
        name: forbid duplicate PSX ROBUST OVERRIDE banners
        language: system
        entry: bash -lc 'ok=0; for f in $(git ls-files tools/*.sh 2>/dev/null); do c=$(grep -c "PSX ROBUST OVERRIDE" "$f" || true); if [ "$c" -gt 1 ]; then echo "Duplicate PSX banner in: $f"; ok=1; fi; done; exit $ok'
        files: ^tools/.*\.sh$

- repo: local
  hooks:
    - id: forbid-cp-n-in-tools
      name: forbid cp -n in tools
      language: system
      entry: bash -lc '(! grep -R --line-number -E "^[[:space:]]*cp[[:space:]]+-n\\b" tools)'
      files: ^tools/.*\.sh$
    - id: forbid-duplicate-psx-override
      name: forbid duplicate PSX ROBUST OVERRIDE banners
      language: system
      entry: bash -lc 'ok=0; for f in $(git ls-files tools/*.sh 2>/dev/null); do c=$(grep -c "PSX ROBUST OVERRIDE" "$f" || true); if [ "$c" -gt 1 ]; then echo "Duplicate PSX banner in: $f"; ok=1; fi; done; exit $ok'
      files: ^tools/.*\.sh$
