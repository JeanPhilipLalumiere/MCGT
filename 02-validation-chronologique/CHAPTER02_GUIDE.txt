# CHAPITRE 2 — GUIDE D’UTILISATION
Validation chronologique (données, figures, scripts)

---

## 1. Objet

Ce guide décrit la production des données, des figures et la procédure d’exécution pour la **validation chronologique** (Chapitre 2) du projet MCGT.  
Il précise les jeux de données requis, les sorties attendues et les critères de contrôle qualité sur la chronologie des jalons.

---

## 2. Organisation des fichiers

### 2.1 Sources LaTeX  (`02-validation-chronologique/`)

- `02_validation_chronologique_conceptuel.tex`
- `02_validation_chronologique_details.tex`
- `CHAPTER02_GUIDE.txt` (ce fichier)

### 2.2 Données (`zz-data/chapter02/`)

- **Entrées principales**
  - `02_milestones_meta.csv`
  - `02_primordial_spectrum_spec.json`

- **Sorties principales (chronologie & optimisation)**
  - `02_timeline_milestones.csv`
  - `02_P_vs_T_grid_data.dat`
  - `02_P_derivative_data.dat`
  - `02_relative_error_timeline.csv`
  - `02_optimal_parameters.json`

- **Sorties spectrales / annexes**
  - `02_P_R_sampling.csv`
  - `02_As_ns_vs_alpha.csv`
  - `02_FG_series.csv`

### 2.3 Figures (`zz-figures/chapter02/`)

- `02_fig_00_spectrum.png`
- `02_fig_01_p_vs_t_evolution.png`
- `02_fig_02_calibration.png`
- `02_fig_03_relative_errors.png`
- `02_fig_04_pipeline_diagram.png`
- `02_fig_05_fg_series.png`
- `02_fig_06_alpha_fit.png`

### 2.4 Scripts (`zz-scripts/chapter02/`)

- **Génération des données**
  - `generate_data_chapter02.py`

- **Helper / noyau théorique**
  - `primordial_spectrum.py` (utilisé comme module par les scripts de génération)

- **Tracé des figures**
  - `plot_fig00_spectrum.py`
  - `plot_fig01_P_vs_T_evolution.py`
  - `plot_fig02_calibration.py`
  - `plot_fig03_relative_errors.py`
  - `plot_fig04_pipeline_diagram.py`
  - `plot_fig05_FG_series.py`
  - `plot_fig06_alpha_fit.py`

- **Environnement**
  - `requirements.txt`

> Comme pour le chapitre 1, les fichiers `.bak`, `.rescue`, `.pyc`, etc. sont des artefacts de développement et ne font pas partie du flux standard documenté ici.

---

## 3. Données d’entrée

### 3.1 Métadonnées des jalons — `02_milestones_meta.csv`

| Colonne   | Description                                             | Unité |
|----------:|:--------------------------------------------------------|:-----:|
| `T_Gyr`   | Âge propre (points de référence)                        | Gyr   |
| `P_ref`   | Valeur de référence \(P(T)\)                            |  –    |
| `classe`  | Catégorie d’exigence : `primary` (≤ 1 %) / `order2` (≤ 10 %) |  –    |

### 3.2 Spécification du spectre primordial — `02_primordial_spectrum_spec.json`

Champs principaux :

- `label_eq`, `formula`, `description`
- `constants` : `A_s0`, `ns0`
- `coefficients` : `c1`, `c1_2`, `c2`, `c2_2`

> Règle d’homogénéisation : les noms de champs et l’usage de la notation \(P_R(k;\alpha)\) sont **alignés** sur les conventions globales (voir `mcgt-global-config.ini` et le chapitre 6).

---

## 4. Données produites

### 4.1 Chronologie des jalons — `02_timeline_milestones.csv`

| Colonne      | Description                                                            | Unité |
|-------------:|:------------------------------------------------------------------------|:-----:|
| `T_Gyr`      | Âge des jalons (croissant)                                             | Gyr   |
| `P_ref`      | Valeur de référence aux jalons                                         |  –    |
| `P_opt`      | Valeur calculée optimisée                                              |  –    |
| `epsilon_i`  | Écart relatif \((P_{\rm calc}-P_{\rm ref})/P_{\rm ref}\)               |  –    |
| `classe`     | `primary` (≤ 1 %) / `order2` (≤ 10 %)                                  |  –    |

### 4.2 Courbe dense \(P(T)\) — `02_P_vs_T_grid_data.dat`

| Colonne  | Description                              | Unité |
|---------:|:------------------------------------------|:-----:|
| `T_Gyr`  | Grille log-uniforme                      | Gyr   |
| `P_calc` | Courbe dense \(P_{\rm calc}(T)\)         |  –    |

### 4.3 Dérivée lissée \(\dot P(T)\) — `02_P_derivative_data.dat`

| Colonne  | Description                         | Unité     |
|---------:|:-------------------------------------|:---------:|
| `T_Gyr`  | Grille identique à 4.2              | Gyr       |
| `dotP`   | Dérivée lissée \( \dot P(T) \)      | adim/Gyr  |

### 4.4 Écarts relatifs — `02_relative_error_timeline.csv`

| Colonne     | Description                               |
|------------:|:-------------------------------------------|
| `T_Gyr`     | Âge des jalons                            |
| `epsilon_i` | Écart relatif aux jalons                  |

### 4.5 Paramètres optimaux — `02_optimal_parameters.json`

Champs typiques :

- `T_split_Gyr`
- `segments.low` / `segments.high` : `alpha0`, `alpha_inf`, `Tc`, `Delta`, `Tp`
- `thresholds` : `primary`, `order2`
- `max_epsilon_primary`, `max_epsilon_order2`

### 4.6 Échantillonnage du spectre — `02_P_R_sampling.csv`

| Colonne | Description                                 | Unité    |
|--------:|:---------------------------------------------|:--------:|
| `alpha` | Paramètre du modèle                         |  –       |
| `k`     | Nombre d’onde comobile                      | h Mpc⁻¹  |
| `P_R`   | Spectre primordial \(P_R(k;\alpha)\)        |  –       |

### 4.7 Paramètres spectraux — `02_As_ns_vs_alpha.csv`

| Colonne | Description              |
|--------:|:--------------------------|
| `alpha` | Paramètre du modèle      |
| `A_s`   | Amplitude scalaire       |
| `n_s`   | Indice spectral          |

### 4.8 Séries F/G — `02_FG_series.csv`

| Colonne | Description                    |
|--------:|:--------------------------------|
| `func`  | `F` ou `G`                     |
| `order` | Ordre (0, 1, 2, …)             |
| `coeff` | Coefficient de la série        |

---

## 5. Figures générées (PNG, 300 dpi)

- `02_fig_00_spectrum.png`  
  Spectre primordial MCGT \(P_R(k;\alpha)\), échelle log–log.

- `02_fig_01_p_vs_t_evolution.png`  
  \(P_{\rm calc}(T)\) vs jalons \(P_{\rm ref}(T_i)\).

- `02_fig_02_calibration.png`  
  Nuage `P_ref` vs `P_calc` + ligne d’identité.

- `02_fig_03_relative_errors.png`  
  \(\epsilon_i\) vs `T_Gyr` (échelle adaptée, souvent symlog).

- `02_fig_04_pipeline_diagram.png`  
  Schéma du pipeline de calcul (flux du chapitre 1 → chapitre 2, etc.).

- `02_fig_05_fg_series.png`  
  Séries \(F(\alpha)-1\) et \(G(\alpha)\) en fonction de `alpha`.

- `02_fig_06_alpha_fit.png`  
  Ajustements \(A_s(\alpha)\) et \(n_s(\alpha)\).

---

## 6. Scripts & exécution

### 6.1 Génération des données

```bash
python zz-scripts/chapter02/generate_data_chapter02.py --all
```

Options usuelles (si disponibles) : `--spectrum`, `--derivative`, `--milestones`.

### 6.2 Tracé des figures

```bash
python zz-scripts/chapter02/plot_fig00_spectrum.py
python zz-scripts/chapter02/plot_fig01_P_vs_T_evolution.py
python zz-scripts/chapter02/plot_fig02_calibration.py
python zz-scripts/chapter02/plot_fig03_relative_errors.py
python zz-scripts/chapter02/plot_fig04_pipeline_diagram.py
python zz-scripts/chapter02/plot_fig05_FG_series.py
python zz-scripts/chapter02/plot_fig06_alpha_fit.py
```

### 6.3 Script helper — `primordial_spectrum.py`

- Fournit la définition de \(P_R(k;\alpha)\) et les utilitaires associés.
- Typiquement **importé** par `generate_data_chapter02.py` et certains scripts de tracé.
- Ne s’exécute pas nécessairement seul en ligne de commande.

---

## 7. Paramètres & environnement

- Environnement Python :
  - Dépendances listées dans `zz-scripts/chapter02/requirements.txt`.
- Paramètres globaux :
  - Cohérents avec `zz-configuration/mcgt-global-config.ini` (cosmologie globale, bornes en `T_Gyr`, etc.).
- Conventions numériques :
  - CSV : séparateur `,`, encodage UTF-8, point décimal `.`.

---

## 8. Contrôles de qualité & critères

- **Chronologie** :
  - `T_Gyr` croissant strict dans `02_timeline_milestones.csv`.
- **Dérivée** :
  - `02_P_derivative_data.dat` lissée, sans oscillations parasites.
  - Fenêtre/polynôme de filtrage SG alignés sur les chapitres 1 et 5.
- **Écarts** :
  - Respecter `max_epsilon_primary` et `max_epsilon_order2` définis dans `02_optimal_parameters.json`.
- **Intégrité** :
  - CSV en UTF-8 (séparateur `,`, point décimal `.`).
  - JSON valides (conformes aux schémas ci-dessous).

---

## 9. Métadonnées & schémas

- JSON :
  - `zz-schemas/02_optimal_parameters.schema.json`
  - `zz-schemas/02_spec_spectrum.schema.json`
- CSV :
  - `zz-schemas/mc_results_table_schema.json` (gabarit tabulaire général)
  - Schémas spécifiques au chapitre 2 le cas échéant.

---

## 10. Procédure standard (résumé)

1. Vérifier / mettre à jour `02_primordial_spectrum_spec.json` (cohérence avec `mcgt-global-config.ini`).
2. Vérifier `02_milestones_meta.csv` (jalons, classes `primary` / `order2`).
3. Lancer `generate_data_chapter02.py` avec `--all` pour produire **toutes** les sorties tabulaires.
4. Générer les figures via les scripts `plot_fig*.py` (section 6.2).
5. Contrôler les seuils `primary` (≤ 1 %) et `order2` (≤ 10 %) à partir de `02_relative_error_timeline.csv` et `02_optimal_parameters.json`.
6. Compiler le chapitre LaTeX (section 11).

---

## 11. Compilation LaTeX

```bash
pdflatex -jobname=chap2_conceptuel 02-validation-chronologique/02_validation_chronologique_conceptuel.tex
pdflatex -jobname=chap2_details    02-validation-chronologique/02_validation_chronologique_details.tex
```
