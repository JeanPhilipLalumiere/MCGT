{
"\$schema": "[https://json-schema.org/draft/2020-12/schema](https://json-schema.org/draft/2020-12/schema)",
"\$id": "zz-schemas/09\_best\_parameters.schema.json",
"title": "Chapter 09 — Best polynomial / rebranch parameters",
"description": "Schéma pour les meilleurs paramètres utilisés pour construire la phase MCGT finale (fit polynomial + unwrap + rebranch). Fichier cible: 09\_best\_parameters.json.",
"type": "object",
"\$defs": {
"fileRef": {
"type": "object",
"properties": {
"path": { "type": "string", "minLength": 1 },
"sha256": { "type": "string", "pattern": "^\[0-9a-fA-F]{64}\$" },
"size\_bytes": { "type": "integer", "minimum": 0 }
},
"required": \["path"],
"additionalProperties": false
}
},
"properties": {
"generated\_at": { "type": "string", "format": "date-time", "description": "Horodatage ISO." },
"producer\_script": { "type": "string", "description": "Script producteur (relatif)." },
"git\_hash": { "anyOf": \[{ "type": "string", "minLength": 7 }, { "type": "null" }], "description": "Commit (optionnel)." },
"version": { "type": "string", "description": "Tag/version lisible (optionnel)." },

```
"basis": { "type": "string", "enum": ["log10", "hz"], "description": "Base polynomiale pour l’ajustement." },
"degree": { "type": "integer", "minimum": 1, "description": "Degré du polynôme (≥1)." },

"coeff_desc": {
  "description": "Coefficients polynomiaux et transformation éventuelle.",
  "oneOf": [
    { "type": "array", "items": { "type": "number" }, "minItems": 1 },
    {
      "type": "object",
      "properties": {
        "coefficients": { "type": "array", "items": { "type": "number" }, "minItems": 1 },
        "x_transform": { "type": "string", "enum": ["log10", "identity"] },
        "x_min": { "type": "number" },
        "x_max": { "type": "number" }
      },
      "required": ["coefficients"],
      "additionalProperties": false
    }
  ]
},

"unwrap_strategy": {
  "type": "string",
  "description": "Stratégie de désemballage de phase.",
  "enum": ["global", "piecewise", "none"],
  "default": "global"
},

"k_cycles": { "type": "integer", "description": "Entier global de rebranch (cycles) minimisant |Δφ|." },

"fit_window_Hz": {
  "type": "array",
  "description": "Fenêtre utilisée pour le fit polynomial.",
  "items": { "type": "number" },
  "minItems": 2,
  "maxItems": 2
},
"metrics_window_Hz": {
  "type": "array",
  "description": "Fenêtre utilisée pour évaluer les métriques (moyenne/mediane/p95/max).",
  "items": { "type": "number" },
  "minItems": 2,
  "maxItems": 2
},

"scores": {
  "type": "object",
  "description": "Métriques de synthèse (résiduel principal) dans metrics_window_Hz.",
  "properties": {
    "mean_abs_20_300": { "type": "number", "minimum": 0 },
    "median_abs_20_300": { "type": "number", "minimum": 0 },
    "p95_abs_20_300": { "type": "number", "minimum": 0 },
    "max_abs_20_300": { "type": "number", "minimum": 0 },
    "n_20_300": { "type": "integer", "minimum": 0 }
  },
  "required": ["p95_abs_20_300"],
  "additionalProperties": false
},

"variant_used": {
  "type": "string",
  "description": "Variante φ optimisée.",
  "enum": ["phi_mcgt", "phi_mcgt_cal", "phi_mcgt_raw"]
},
"phase_variant": {
  "type": "string",
  "description": "Alias de variant_used (déprécié si les deux sont présents).",
  "enum": ["phi_mcgt", "phi_mcgt_cal", "phi_mcgt_raw"]
},

"inputs": {
  "type": "object",
  "description": "Entrées amont utilisées pour calculer les meilleurs paramètres.",
  "properties": {
    "ref_csv": { "oneOf": [{ "type": "string" }, { "$ref": "#/$defs/fileRef" }], "description": "Phases GR de référence (IMRPhenom*)." },
    "prepoly_csv": { "oneOf": [{ "type": "string" }, { "$ref": "#/$defs/fileRef" }], "description": "Phases MCGT pré-polynôme (raw/calibrated)." },
    "diff_csv": { "oneOf": [{ "type": "string" }, { "$ref": "#/$defs/fileRef" }], "description": "CSV résiduel (optionnel)." },
    "metrics_json": { "oneOf": [{ "type": "string" }, { "$ref": "#/$defs/fileRef" }], "description": "JSON de métriques (optionnel)." }
  },
  "additionalProperties": false
},

"repro": {
  "type": "object",
  "description": "Environnement d’exécution.",
  "properties": {
    "python": { "type": "string" },
    "libs": { "type": "object", "additionalProperties": { "type": "string" } }
  },
  "additionalProperties": false
},

"notes": { "type": "string" }
```

},

"required": \["basis", "degree", "coeff\_desc", "k\_cycles", "fit\_window\_Hz", "metrics\_window\_Hz"],
"additionalProperties": false,

"examples": \[
{
"generated\_at": "2025-08-23T12:00:00Z",
"producer\_script": "zz-scripts/chapter9/opt\_poly\_rebranch.py",
"git\_hash": "abcdef1",
"basis": "log10",
"degree": 5,
"coeff\_desc": \[-134.8352599400951, 1431.231493474761, -6157.841503217142, 13479.057758092878, -14992.867016559154, 7004.059173892351],
"unwrap\_strategy": "global",
"k\_cycles": -56,
"fit\_window\_Hz": \[30.0, 250.0],
"metrics\_window\_Hz": \[20.0, 300.0],
"scores": { "mean\_abs\_20\_300": 0.12138579423319663, "p95\_abs\_20\_300": 0.7104087123286049, "max\_abs\_20\_300": 1.7761673463095065, "n\_20\_300": 117 },
"variant\_used": "phi\_mcgt",
"inputs": {
"ref\_csv": { "path": "zz-data/chapter9/09\_phases\_imrphenom.csv" },
"prepoly\_csv": { "path": "zz-data/chapter9/09\_phases\_mcgt.prepoly.csv" },
"diff\_csv": { "path": "zz-data/chapter9/09\_diff\_phase.csv" },
"metrics\_json": { "path": "zz-data/chapter9/09\_metrics\_phase.json" }
},
"repro": { "python": "3.12.3", "libs": { "numpy": "2.3.1", "pandas": "2.3.1" } },
"notes": "Paramètres choisis pour minimiser p95 sur 20–300 Hz."
}
]
}
