# Exigences pour le Chapitre 8 (Couplage sombre)

1. **Environnement système**

   * Système : Ubuntu 20.04 (WSL ou natif) ou équivalent Linux
   * Espace disque : ≥ 500 Mo libre

2. **Environnement Python**

   * Python ≥ 3.9
   * Créer et activer un environnement virtuel spécifique :

     ```
     cd ~/MCGT
     python3 -m venv venv8
     source venv8/bin/activate
     ```
   * Installer les dépendances :

     ```
     pip install --upgrade pip
     pip install numpy pandas scipy matplotlib
     ```

3. **Données brutes & scripts d’extraction**

   * **BAO**
     – Source : SDSS-DR12 (BOSS) bao\_distances\_DR12v5.dat
     `https://raw.githubusercontent.com/SDSS-Science-Archive-Server/BOSS-LSS/master/lss/BAOtables/bao_distances_DR12v5.dat`
     – Extraction (z, D\_V, σ\_DV) via :
     `zz-scripts/chapter08/utils/extract_bao_data.py` → `zz-data/chapter08/08_bao_data.csv`
   * **Pantheon+**
     – Source : Pantheon + SH0ES.dat
     `https://raw.githubusercontent.com/PantheonPlusSH0ES/DataRelease/main/Pantheon%2B_Data/4_DISTANCES_AND_COVAR/Pantheon%2BSH0ES.dat`
     – Extraction (z, μ, σ\_μ) via :
     `zz-scripts/chapter08/utils/extract_pantheon_plus_data.py` → `zz-data/chapter08/08_pantheon_data.csv`

4. **Structure du dépôt**

```
MCGT/
├─ 08-dark-coupling/             # sources LaTeX, GUIDE
├─ zz-data/chapter08/            # .csv, .json générés
├─ zz-scripts/chapter08/         # generate_*.py, plot_*.py
│   └─ utils/                    # extract_*.py, verify_z_grid.py, coupling_example_model.py
├─ zz-figures/chapter08/         # .png produits
└─ venv8/                        # environnement virtuel Python
```

5. **Exécution du pipeline**

6. Génération des données :

   ```bash
   source venv8/bin/activate
   python zz-scripts/chapter08/generate_data_chapter08.py \
     --q0star_min -0.1 --q0star_max 0.1 --n_points 201 \
     [--export-derivative] [--export-heatmap --param2_min … --param2_max … --n_param2 …]
   ```

7. Tracé des figures :

   ```bash
   python zz-scripts/chapter08/plot_fig01_chi2_total_vs_q0.py
   python zz-scripts/chapter08/plot_fig02_dv_vs_z.py
   python zz-scripts/chapter08/plot_fig03_mu_vs_z.py
   python zz-scripts/chapter08/plot_fig04_chi2_heatmap.py   # si heatmap 2D
   python zz-scripts/chapter08/plot_fig05_residuals.py
   python zz-scripts/chapter08/plot_fig06_normalized_residuals_distribution.py
   python zz-scripts/chapter08/plot_fig07_chi2_profile.py
   ```

8. **Compilation LaTeX**

```bash
cd 08-dark-coupling/
pdflatex -interaction=nonstopmode 08_dark_coupling_conceptual.tex
pdflatex -interaction=nonstopmode 08_dark_coupling_details.tex
```

7. **Tests & validations**

   * Vérifier l’existence et la non-nullité des fichiers dans `zz-data/chapter08/` :

     ```
     08_coupling_milestones.csv
     08_bao_data.csv
     08_pantheon_data.csv
     08_chi2_total_vs_q0.csv
     [08_chi2_derivative.csv]
     [08_chi2_scan2D.csv]
     08_dv_theory_z.csv
     08_mu_theory_z.csv
     08_coupling_params.json
     ```
   * S’assurer qu’il n’y a pas de `NaN` ou `Inf` dans les CSV
   * `max_epsilon_primary` < 0.01 et `max_epsilon_order2` < 0.10 dans `08_coupling_params.json`
   * Ouvrir chaque figure PNG dans `zz-figures/chapter08/` pour un contrôle visuel
